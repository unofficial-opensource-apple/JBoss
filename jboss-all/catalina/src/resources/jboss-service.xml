<?xml version="1.0" encoding="UTF-8"?>
<!-- Set catalina.home to the location of the Tomcat-4.x dist.
The default value is that of the JBoss/Catalina bundle where the
jakarta-tomcat-4.0.3-LE-jdk14 is included as jboss_dist/catalina
 -->
<!DOCTYPE server [
  <!ENTITY catalina.home "../catalina">
]>

<!-- The service configuration for the embedded Tomcat4 web container
-->
<server>

  <classpath codebase="file:&catalina.home;/common/lib/" archives="*"/>
  <classpath codebase="file:&catalina.home;/server/lib/" archives="*"/>
  <classpath codebase="file:&catalina.home;/bin/" archives="*"/>
  <classpath codebase="file:&catalina.home;/lib/" archives="*"/>
 
  <mbean code="org.jboss.web.catalina.EmbeddedCatalinaServiceSX"
    name="jboss.web:service=WebServer">
    <attribute name="CatalinaHome">&catalina.home;</attribute>

    <!--
      *******************************************************
      ****************** CLUSTERING *************************
      *******************************************************
      In order to activate HTTP Session clustering for Tomcat
      make sure you run JBoss's "all" configuration i.e. 
      "run -c all"
      (the default configuration doesn't contain clustering)
      
      Furthermore, you may change SnapshotMode and 
      SnapshotInterval attributes below to indicate when to 
      synchronize changes with the other node(s). 

      If you use Apache+mod_jk(2) you will most probably use 
      the AJP1.3 connector below. Thus, if you so wish, 
      you may comment (i.e. deactivate) the HTTP connector 
      as it won't be used anymore.

      *******************************************************
      *******************************************************
      *******************************************************
     -->
      
    <!-- 
      If you are using clustering, the following two attributes
      define when the sessions are replicated to the other nodes.
      The default value, "instant", synchronously replicates changes
      to the other nodes. In this case, the "SnapshotInterval" attribute
      is not used.
      The "interval" mode, in association with the "SnapshotInterval" 
      attribute, indicates that Tomcat will only replicates modified
      sessions every "SnapshotInterval" miliseconds at most.
    -->
    <attribute name="SnapshotMode">instant</attribute> <!-- you may switch to "interval" -->
    <attribute name="SnapshotInterval">2000</attribute>

    
    <attribute name="Config">
      <Server>
         <Service name = "JBoss-Tomcat">
            <Engine name="MainEngine" defaultHost="localhost">
               <Logger className = "org.jboss.web.catalina.Log4jLogger"
                  verbosityLevel = "trace" category = "org.jboss.web.localhost.Engine"/>
               <Host name="localhost">

                  <!-- Access logger -->
                  <Valve className = "org.apache.catalina.valves.AccessLogValve"
                     prefix = "localhost_access" suffix = ".log"
                     pattern = "common" directory = "../server/default/log" />

                  <!-- Default context parameters -->
                  <DefaultContext cookies = "true" crossContext = "true" override = "true" />
               </Host>
            </Engine>

            <!-- A HTTP Connector on port 8080 -->
            <Connector className = "org.apache.catalina.connector.http.HttpConnector"
               port = "8080" minProcessors = "3" maxProcessors = "10" enableLookups = "true"
               acceptCount = "10" debug = "0" connectionTimeout = "60000"/>
         </Service>
      </Server>
    </attribute>
  </mbean>

</server>
